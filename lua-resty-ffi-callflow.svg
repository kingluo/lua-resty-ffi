<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="749" height="480" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Note over nginx/envoy worker thread,polling thread: Create runtime
nginx/envoy worker thread -> nginx/envoy worker thread: calls lua_resty_ffi_init()
nginx/envoy worker thread -> polling thread: create
polling thread -> asyncio loop hread: create
Note over nginx/envoy worker thread,polling thread: Invoke a request
nginx/envoy worker thread -> polling thread: post request, yield
polling thread -> asyncio loop hread: send async task
asyncio loop hread --> nginx/envoy worker thread: response, resume]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="260.00001525878906" height="40" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="45.555556297302246" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">nginx/envoy worker thread</tspan></text></g><g class="actor"><rect x="10" y="420" width="260.00001525878906" height="40" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="20" y="445.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="20">nginx/envoy worker thread</tspan></text></g><line x1="140.00000762939453" x2="140.00000762939453" y1="60" y2="420" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="352.3958511352539" y="20" width="154.40972900390625" height="40" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="362.3958511352539" y="45.555556297302246" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="362.3958511352539">polling thread</tspan></text></g><g class="actor"><rect x="352.3958511352539" y="420" width="154.40972900390625" height="40" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="362.3958511352539" y="445.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="362.3958511352539">polling thread</tspan></text></g><line x1="429.60071563720703" x2="429.60071563720703" y1="60" y2="420" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="actor"><rect x="526.8055801391602" y="20" width="192.81251525878906" height="40" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="536.8055801391602" y="45.555556297302246" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="536.8055801391602">asyncio loop hread</tspan></text></g><g class="actor"><rect x="526.8055801391602" y="420" width="192.81251525878906" height="40" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="536.8055801391602" y="445.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="536.8055801391602">asyncio loop hread</tspan></text></g><line x1="623.2118377685547" x2="623.2118377685547" y1="60" y2="420" stroke="#000000" fill="none" style="stroke-width: 2;"></line><g class="note"><rect x="130.00000762939453" y="80" width="309.6007080078125" height="30" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="135.00000762939453" y="100.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="135.00000762939453">Create runtime</tspan></text></g><g class="signal"><text x="165.00000762939453" y="145" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="165.00000762939453">calls lua_resty_ffi_init()</tspan></text><line x1="140.00000762939453" x2="160.00000762939453" y1="130" y2="130" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="160.00000762939453" x2="160.00000762939453" y1="130" y2="155" stroke="#000000" fill="none" style="stroke-width: 2;"></line><line x1="160.00000762939453" x2="140.00000762939453" y1="155" y2="155" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="255.99827766418457" y="180.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="255.99827766418457">create</tspan></text><line x1="140.00000762939453" x2="429.60071563720703" y1="190" y2="190" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="497.60419273376465" y="220.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="497.60419273376465">create</tspan></text><line x1="429.60071563720703" x2="623.2118377685547" y1="230" y2="230" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="note"><rect x="130.00000762939453" y="250" width="309.6007080078125" height="30" stroke="#000000" fill="#ffffff" style="stroke-width: 2;"></rect><text x="135.00000762939453" y="270.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="135.00000762939453">Invoke a request</tspan></text></g><g class="signal"><text x="193.59375762939453" y="310.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="193.59375762939453">post request, yield</tspan></text><line x1="140.00000762939453" x2="429.60071563720703" y1="320" y2="320" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="454.2062797546387" y="350.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="454.2062797546387">send async task</tspan></text><line x1="429.60071563720703" x2="623.2118377685547" y1="360" y2="360" stroke="#000000" fill="none" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g><g class="signal"><text x="304.80036544799805" y="390.55555629730225" style="font-size: 16px; font-family: &quot;Andale Mono&quot;, monospace;"><tspan x="304.80036544799805">response, resume</tspan></text><line x1="623.2118377685547" x2="140.00000762939453" y1="400" y2="400" stroke="#000000" fill="none" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(&quot;#markerArrowBlock&quot;);"></line></g></svg>